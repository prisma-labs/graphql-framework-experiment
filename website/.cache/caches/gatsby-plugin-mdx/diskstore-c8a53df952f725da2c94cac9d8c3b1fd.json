{"expireTime":9007200846064555000,"key":"gatsby-plugin-mdx-entire-payload-7e6bd92104870e32f08a1377ee436cda-","val":{"mdast":{"type":"root","children":[{"type":"paragraph","children":[{"type":"text","value":"\\n## Chapter 4 ","position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":16,"offset":15},"indent":[]}},{"type":"jsx","value":"<br/>","position":{"start":{"line":1,"column":16,"offset":15},"end":{"line":1,"column":21,"offset":20},"indent":[]}},{"type":"text","value":" Testing Your API","position":{"start":{"line":1,"column":21,"offset":20},"end":{"line":1,"column":38,"offset":37},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":1,"column":38,"offset":37},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"So far you've been validating your work by manual interacting with the Playground. That might be reasonable at first (depending on your relationship to TDD) but it will not scale. At some point you are going to want automated testing. So in this chapter you're going to add some automated tests to your e-commerce project. You'll learn about:","position":{"start":{"line":3,"column":1,"offset":39},"end":{"line":3,"column":343,"offset":381},"indent":[]}}],"position":{"start":{"line":3,"column":1,"offset":39},"end":{"line":3,"column":343,"offset":381},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Nexus' approach to testing","position":{"start":{"line":5,"column":3,"offset":385},"end":{"line":5,"column":29,"offset":411},"indent":[]}}],"position":{"start":{"line":5,"column":3,"offset":385},"end":{"line":5,"column":29,"offset":411},"indent":[]}}],"position":{"start":{"line":5,"column":1,"offset":383},"end":{"line":5,"column":29,"offset":411},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Setting up a test environment","position":{"start":{"line":6,"column":3,"offset":414},"end":{"line":6,"column":32,"offset":443},"indent":[]}}],"position":{"start":{"line":6,"column":3,"offset":414},"end":{"line":6,"column":32,"offset":443},"indent":[]}}],"position":{"start":{"line":6,"column":1,"offset":412},"end":{"line":6,"column":32,"offset":443},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":7,"column":3,"offset":446},"end":{"line":7,"column":7,"offset":450},"indent":[]}},{"type":"inlineCode","value":"nexus/testing","position":{"start":{"line":7,"column":7,"offset":450},"end":{"line":7,"column":22,"offset":465},"indent":[]}},{"type":"text","value":" module","position":{"start":{"line":7,"column":22,"offset":465},"end":{"line":7,"column":29,"offset":472},"indent":[]}}],"position":{"start":{"line":7,"column":3,"offset":446},"end":{"line":7,"column":29,"offset":472},"indent":[]}}],"position":{"start":{"line":7,"column":1,"offset":444},"end":{"line":7,"column":29,"offset":472},"indent":[]}}],"position":{"start":{"line":5,"column":1,"offset":383},"end":{"line":7,"column":29,"offset":472},"indent":[1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"It's At the System Level","position":{"start":{"line":9,"column":4,"offset":477},"end":{"line":9,"column":28,"offset":501},"indent":[]}}],"position":{"start":{"line":9,"column":1,"offset":474},"end":{"line":9,"column":28,"offset":501},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"There are multiple ways you can test a GraphQL API. One way is to extract resolvers into isolated functions and then unit test them. Of course these are rarely pure functions so those unit tests either become partial integration tests or mocks are introduced to try and retain the unit level of testing. Unit testing resolvers can work well, but here are some reasons why and where it might not;","position":{"start":{"line":11,"column":1,"offset":503},"end":{"line":11,"column":396,"offset":898},"indent":[]}}],"position":{"start":{"line":11,"column":1,"offset":503},"end":{"line":11,"column":396,"offset":898},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The Nexus Prisma plugin (discussed later) can remove the need to even write resolvers in which case testing ","position":{"start":{"line":13,"column":3,"offset":902},"end":{"line":13,"column":111,"offset":1010},"indent":[]}},{"type":"linkReference","identifier":"those","label":"those","referenceType":"shortcut","children":[{"type":"text","value":"those","position":{"start":{"line":13,"column":112,"offset":1011},"end":{"line":13,"column":117,"offset":1016},"indent":[]}}],"position":{"start":{"line":13,"column":111,"offset":1010},"end":{"line":13,"column":118,"offset":1017},"indent":[]}},{"type":"text","value":" resolvers doesn't make sense.","position":{"start":{"line":13,"column":118,"offset":1017},"end":{"line":13,"column":148,"offset":1047},"indent":[]}}],"position":{"start":{"line":13,"column":3,"offset":902},"end":{"line":13,"column":148,"offset":1047},"indent":[]}}],"position":{"start":{"line":13,"column":1,"offset":900},"end":{"line":13,"column":148,"offset":1047},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Thanks to the enhanced static type safety brought by Nexus, testing for correct handling of different input types and expected output types can be greatly reduced. For example you shouldn't need to test that your resolver checks for nulls before accessing nullable fields of an input object. And you don't need to test that your resolver is returning the right type.","position":{"start":{"line":14,"column":3,"offset":1050},"end":{"line":14,"column":369,"offset":1416},"indent":[]}}],"position":{"start":{"line":14,"column":3,"offset":1050},"end":{"line":14,"column":369,"offset":1416},"indent":[]}}],"position":{"start":{"line":14,"column":1,"offset":1048},"end":{"line":14,"column":369,"offset":1416},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Unit testing resolvers cannot provide a client perspective view of correctness since they focus on internals. If you want to test but have limited time/capacity to do so, you might choose to minimize/forgo the unit level in favor of system/integration tests that are closer to or at the level of a client perspective.","position":{"start":{"line":15,"column":3,"offset":1419},"end":{"line":15,"column":320,"offset":1736},"indent":[]}}],"position":{"start":{"line":15,"column":3,"offset":1419},"end":{"line":15,"column":320,"offset":1736},"indent":[]}}],"position":{"start":{"line":15,"column":1,"offset":1417},"end":{"line":15,"column":320,"offset":1736},"indent":[]}}],"position":{"start":{"line":13,"column":1,"offset":900},"end":{"line":15,"column":320,"offset":1736},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Testing non-trivial resolvers in isolation is likely to be a good investment in most cases but its up to you as a developer. What Nexus provides help with is not at this level, but higher up in the ","position":{"start":{"line":17,"column":1,"offset":1738},"end":{"line":17,"column":199,"offset":1936},"indent":[]}},{"type":"link","title":null,"url":"https://codingjourneyman.com/tag/uncle-bob/page/2/","children":[{"type":"text","value":"testing pyramid","position":{"start":{"line":17,"column":200,"offset":1937},"end":{"line":17,"column":215,"offset":1952},"indent":[]}}],"position":{"start":{"line":17,"column":199,"offset":1936},"end":{"line":17,"column":268,"offset":2005},"indent":[]}},{"type":"text","value":", at the system level. System testing means tests that will run operations against your API just like a real client would. This chapter will focus on that. Let's dive-in!","position":{"start":{"line":17,"column":268,"offset":2005},"end":{"line":17,"column":438,"offset":2175},"indent":[]}}],"position":{"start":{"line":17,"column":1,"offset":1738},"end":{"line":17,"column":438,"offset":2175},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Setting up Your Test Environment","position":{"start":{"line":19,"column":4,"offset":2180},"end":{"line":19,"column":36,"offset":2212},"indent":[]}}],"position":{"start":{"line":19,"column":1,"offset":2177},"end":{"line":19,"column":36,"offset":2212},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"During this tutorial, you'll use the ","position":{"start":{"line":21,"column":1,"offset":2214},"end":{"line":21,"column":38,"offset":2251},"indent":[]}},{"type":"link","title":null,"url":"https://jestjs.io/","children":[{"type":"text","value":"Jest testing framework","position":{"start":{"line":21,"column":39,"offset":2252},"end":{"line":21,"column":61,"offset":2274},"indent":[]}}],"position":{"start":{"line":21,"column":38,"offset":2251},"end":{"line":21,"column":82,"offset":2295},"indent":[]}},{"type":"text","value":" to test your API. This is not mandatory but we do recommend it. Still, in general, outside this tutorial, if you prefer another testing framework, feel free to use it.","position":{"start":{"line":21,"column":82,"offset":2295},"end":{"line":21,"column":250,"offset":2463},"indent":[]}}],"position":{"start":{"line":21,"column":1,"offset":2214},"end":{"line":21,"column":250,"offset":2463},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"First, install ","position":{"start":{"line":23,"column":1,"offset":2465},"end":{"line":23,"column":16,"offset":2480},"indent":[]}},{"type":"inlineCode","value":"jest","position":{"start":{"line":23,"column":16,"offset":2480},"end":{"line":23,"column":22,"offset":2486},"indent":[]}},{"type":"text","value":" and accompanying tools","position":{"start":{"line":23,"column":22,"offset":2486},"end":{"line":23,"column":45,"offset":2509},"indent":[]}}],"position":{"start":{"line":23,"column":1,"offset":2465},"end":{"line":23,"column":45,"offset":2509},"indent":[]}},{"type":"code","lang":"bash","meta":null,"value":"npm add --save-dev jest @types/jest ts-jest","position":{"start":{"line":25,"column":1,"offset":2511},"end":{"line":27,"column":4,"offset":2566},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Then, configure jest and npm scripts in your ","position":{"start":{"line":29,"column":1,"offset":2568},"end":{"line":29,"column":46,"offset":2613},"indent":[]}},{"type":"inlineCode","value":"package.json","position":{"start":{"line":29,"column":46,"offset":2613},"end":{"line":29,"column":60,"offset":2627},"indent":[]}}],"position":{"start":{"line":29,"column":1,"offset":2568},"end":{"line":29,"column":60,"offset":2627},"indent":[]}},{"type":"code","lang":"json","meta":null,"value":"\"scripts\": {\n  \"test\": \"jest\"\n},\n\"jest\": {\n  \"preset\": \"ts-jest\",\n  \"testEnvironment\": \"node\"\n}","position":{"start":{"line":31,"column":1,"offset":2629},"end":{"line":39,"column":4,"offset":2736},"indent":[1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Finally, create a ","position":{"start":{"line":41,"column":1,"offset":2738},"end":{"line":41,"column":19,"offset":2756},"indent":[]}},{"type":"inlineCode","value":"tests","position":{"start":{"line":41,"column":19,"offset":2756},"end":{"line":41,"column":26,"offset":2763},"indent":[]}},{"type":"text","value":" folder at the root of your project and a ","position":{"start":{"line":41,"column":26,"offset":2763},"end":{"line":41,"column":68,"offset":2805},"indent":[]}},{"type":"inlineCode","value":"Post.test.ts","position":{"start":{"line":41,"column":68,"offset":2805},"end":{"line":41,"column":82,"offset":2819},"indent":[]}},{"type":"text","value":" file inside it","position":{"start":{"line":41,"column":82,"offset":2819},"end":{"line":41,"column":97,"offset":2834},"indent":[]}}],"position":{"start":{"line":41,"column":1,"offset":2738},"end":{"line":41,"column":97,"offset":2834},"indent":[]}},{"type":"code","lang":"bash","meta":null,"value":"mkdir tests && touch tests/Post.test.ts","position":{"start":{"line":43,"column":1,"offset":2836},"end":{"line":45,"column":4,"offset":2887},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"You're set.","position":{"start":{"line":47,"column":1,"offset":2889},"end":{"line":47,"column":12,"offset":2900},"indent":[]}}],"position":{"start":{"line":47,"column":1,"offset":2889},"end":{"line":47,"column":12,"offset":2900},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Testing The Publish Mutation","position":{"start":{"line":49,"column":4,"offset":2905},"end":{"line":49,"column":32,"offset":2933},"indent":[]}}],"position":{"start":{"line":49,"column":1,"offset":2902},"end":{"line":49,"column":32,"offset":2933},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Nexus comes with a special testing module that you can import from ","position":{"start":{"line":51,"column":1,"offset":2935},"end":{"line":51,"column":68,"offset":3002},"indent":[]}},{"type":"inlineCode","value":"nexus/testing","position":{"start":{"line":51,"column":68,"offset":3002},"end":{"line":51,"column":83,"offset":3017},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":51,"column":83,"offset":3017},"end":{"line":51,"column":84,"offset":3018},"indent":[]}}],"position":{"start":{"line":51,"column":1,"offset":2935},"end":{"line":51,"column":84,"offset":3018},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Its primary export is the ","position":{"start":{"line":53,"column":1,"offset":3020},"end":{"line":53,"column":27,"offset":3046},"indent":[]}},{"type":"inlineCode","value":"createTestContext","position":{"start":{"line":53,"column":27,"offset":3046},"end":{"line":53,"column":46,"offset":3065},"indent":[]}},{"type":"text","value":" function which is designed for running system tests. When run, it will boot your app in the same process as the test suite and expose an interface for your tests to interact with it. Jest runs each test suite in its own process, so if you have have say eight test suites running in parallel that means you'll have eight app processes running too.","position":{"start":{"line":53,"column":46,"offset":3065},"end":{"line":53,"column":393,"offset":3412},"indent":[]}}],"position":{"start":{"line":53,"column":1,"offset":3020},"end":{"line":53,"column":393,"offset":3412},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Before jumping into your first test we will show you a pattern that more tightly integrates ","position":{"start":{"line":55,"column":1,"offset":3414},"end":{"line":55,"column":93,"offset":3506},"indent":[]}},{"type":"inlineCode","value":"createTestContext","position":{"start":{"line":55,"column":93,"offset":3506},"end":{"line":55,"column":112,"offset":3525},"indent":[]}},{"type":"text","value":" into jest. Nexus will probably ship something like as follows or better in the future, but for now you can just add this as test helper in your Nexus projects.","position":{"start":{"line":55,"column":112,"offset":3525},"end":{"line":55,"column":272,"offset":3685},"indent":[]}}],"position":{"start":{"line":55,"column":1,"offset":3414},"end":{"line":55,"column":272,"offset":3685},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Create a ","position":{"start":{"line":57,"column":1,"offset":3687},"end":{"line":57,"column":10,"offset":3696},"indent":[]}},{"type":"inlineCode","value":"tests/__helpers.ts","position":{"start":{"line":57,"column":10,"offset":3696},"end":{"line":57,"column":30,"offset":3716},"indent":[]}},{"type":"text","value":" module with the following contents.","position":{"start":{"line":57,"column":30,"offset":3716},"end":{"line":57,"column":66,"offset":3752},"indent":[]}}],"position":{"start":{"line":57,"column":1,"offset":3687},"end":{"line":57,"column":66,"offset":3752},"indent":[]}},{"type":"code","lang":"bash","meta":null,"value":"touch tests/__helpers.ts","position":{"start":{"line":59,"column":1,"offset":3754},"end":{"line":61,"column":4,"offset":3790},"indent":[1,1]}},{"type":"jsx","value":"<!-- prettier-ignore -->","position":{"start":{"line":63,"column":1,"offset":3792},"end":{"line":63,"column":25,"offset":3816},"indent":[]}},{"type":"code","lang":"ts","meta":null,"value":"// tests/__helpers.ts                                     // 1\n\nimport { createTestContext as originalCreateTestContext, TestContext } from 'nexus/testing'\n\nexport function createTestContext() {\n  let ctx = {} as TestContext                             // 2\n\n  beforeAll(async () => {\n    Object.assign(ctx, await originalCreateTestContext()) // 3\n    await ctx.app.start()                                 // 4\n  })\n\n  afterAll(async () => {\n    await ctx.app.stop()                                  // 5\n  })\n\n  return ctx\n}","position":{"start":{"line":64,"column":1,"offset":3817},"end":{"line":83,"column":4,"offset":4352},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"list","ordered":true,"start":1,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The module name prefix ","position":{"start":{"line":85,"column":4,"offset":4357},"end":{"line":85,"column":27,"offset":4380},"indent":[]}},{"type":"inlineCode","value":"__","position":{"start":{"line":85,"column":27,"offset":4380},"end":{"line":85,"column":31,"offset":4384},"indent":[]}},{"type":"text","value":" matches that of jest's for snapshot folders ","position":{"start":{"line":85,"column":31,"offset":4384},"end":{"line":85,"column":76,"offset":4429},"indent":[]}},{"type":"inlineCode","value":"__snapshots__","position":{"start":{"line":85,"column":76,"offset":4429},"end":{"line":85,"column":91,"offset":4444},"indent":[]}}],"position":{"start":{"line":85,"column":4,"offset":4357},"end":{"line":85,"column":91,"offset":4444},"indent":[]}}],"position":{"start":{"line":85,"column":1,"offset":4354},"end":{"line":85,"column":91,"offset":4444},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Create an object that will be returned immediately but mutated before tests run","position":{"start":{"line":86,"column":4,"offset":4448},"end":{"line":86,"column":83,"offset":4527},"indent":[]}}],"position":{"start":{"line":86,"column":4,"offset":4448},"end":{"line":86,"column":83,"offset":4527},"indent":[]}}],"position":{"start":{"line":86,"column":1,"offset":4445},"end":{"line":86,"column":83,"offset":4527},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Before tests run create the test context. This does most of the work like getting your app instance.","position":{"start":{"line":87,"column":4,"offset":4531},"end":{"line":87,"column":104,"offset":4631},"indent":[]}}],"position":{"start":{"line":87,"column":4,"offset":4531},"end":{"line":87,"column":104,"offset":4631},"indent":[]}}],"position":{"start":{"line":87,"column":1,"offset":4528},"end":{"line":87,"column":104,"offset":4631},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Before tests run start the app","position":{"start":{"line":88,"column":4,"offset":4635},"end":{"line":88,"column":34,"offset":4665},"indent":[]}}],"position":{"start":{"line":88,"column":4,"offset":4635},"end":{"line":88,"column":34,"offset":4665},"indent":[]}}],"position":{"start":{"line":88,"column":1,"offset":4632},"end":{"line":88,"column":34,"offset":4665},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"After tests complete, stop the app. This will for example close your app's HTTP server.","position":{"start":{"line":89,"column":4,"offset":4669},"end":{"line":89,"column":91,"offset":4756},"indent":[]}}],"position":{"start":{"line":89,"column":4,"offset":4669},"end":{"line":89,"column":91,"offset":4756},"indent":[]}}],"position":{"start":{"line":89,"column":1,"offset":4666},"end":{"line":89,"column":91,"offset":4756},"indent":[]}}],"position":{"start":{"line":85,"column":1,"offset":4354},"end":{"line":89,"column":91,"offset":4756},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Alright, now you will test your ","position":{"start":{"line":91,"column":1,"offset":4758},"end":{"line":91,"column":33,"offset":4790},"indent":[]}},{"type":"inlineCode","value":"publish","position":{"start":{"line":91,"column":33,"offset":4790},"end":{"line":91,"column":42,"offset":4799},"indent":[]}},{"type":"text","value":" mutation. Because we want to start from a clean database, we'll just remove the pre-seeded data in the in-memory database that we've been using up until now.","position":{"start":{"line":91,"column":42,"offset":4799},"end":{"line":91,"column":200,"offset":4957},"indent":[]}}],"position":{"start":{"line":91,"column":1,"offset":4758},"end":{"line":91,"column":200,"offset":4957},"indent":[]}},{"type":"code","lang":"diff","meta":null,"value":"// api/db.ts\nexport const db = {\n- posts: [{ id: 1, title: 'Nexus', body: '...', published: false }],\n+ posts: []\n}","position":{"start":{"line":93,"column":1,"offset":4959},"end":{"line":99,"column":4,"offset":5086},"indent":[1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Now use your new helper and scaffold your first test:","position":{"start":{"line":101,"column":1,"offset":5088},"end":{"line":101,"column":54,"offset":5141},"indent":[]}}],"position":{"start":{"line":101,"column":1,"offset":5088},"end":{"line":101,"column":54,"offset":5141},"indent":[]}},{"type":"jsx","value":"<!-- prettier-ignore -->","position":{"start":{"line":103,"column":1,"offset":5143},"end":{"line":103,"column":25,"offset":5167},"indent":[]}},{"type":"code","lang":"ts","meta":null,"value":"// tests/Post.test.ts\n\nimport { createTestContext } from './__helpers'\n\nconst ctx = createTestContext()\n\nit('ensures that a draft can be created and published', async () => {\n  // Create a new draft\n  const draftResult = await ctx.app.query(`                 # 1\n    mutation {\n      createDraft(title: \"Nexus\", body: \"...\") {            # 2\n        id\n        title\n        body\n        published\n      }\n    }\n  `)\n\n  // Snapshot that draft and expect `published` to be false\n  expect(draftResult).toMatchInlineSnapshot(`                // 3\n    Object {\n      \"createDraft\": Object {\n        \"body\": \"...\",\n        \"id\": 1,\n        \"published\": false,\n        \"title\": \"Nexus\",\n      },\n    }\n  `)\n\n  // Publish the previously created draft\n  const publishResult = await ctx.app.query(`\n    mutation publishDraft($draftId: Int!) {\n      publish(draftId: $draftId) {\n        id\n        title\n        body\n        published\n      }\n    }\n  `,\n    { draftId: draftResult.createDraft.id }\n  )\n\n  // Snapshot the published draft and expect `published` to be true\n  expect(publishResult).toMatchInlineSnapshot(`\n    Object {\n      \"publish\": Object {\n        \"body\": \"...\",\n        \"id\": 1,\n        \"published\": true,\n        \"title\": \"Nexus\",\n      },\n    }\n  `)\n})","position":{"start":{"line":104,"column":1,"offset":5168},"end":{"line":162,"column":4,"offset":6441},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"list","ordered":true,"start":1,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The test context exposes a GraphQL client at ","position":{"start":{"line":164,"column":4,"offset":6446},"end":{"line":164,"column":49,"offset":6491},"indent":[]}},{"type":"inlineCode","value":"ctx.app.query","position":{"start":{"line":164,"column":49,"offset":6491},"end":{"line":164,"column":64,"offset":6506},"indent":[]}},{"type":"text","value":" that will help us run operations against our API. Here We're using it to send a publish mutation.","position":{"start":{"line":164,"column":64,"offset":6506},"end":{"line":164,"column":162,"offset":6604},"indent":[]}}],"position":{"start":{"line":164,"column":4,"offset":6446},"end":{"line":164,"column":162,"offset":6604},"indent":[]}}],"position":{"start":{"line":164,"column":1,"offset":6443},"end":{"line":164,"column":162,"offset":6604},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"This is the mutation from the end of last chapter.","position":{"start":{"line":165,"column":4,"offset":6608},"end":{"line":165,"column":54,"offset":6658},"indent":[]}}],"position":{"start":{"line":165,"column":4,"offset":6608},"end":{"line":165,"column":54,"offset":6658},"indent":[]}}],"position":{"start":{"line":165,"column":1,"offset":6605},"end":{"line":165,"column":54,"offset":6658},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The result will be snapshoted inline allowing us to see the input and output colocated!","position":{"start":{"line":166,"column":4,"offset":6662},"end":{"line":166,"column":91,"offset":6749},"indent":[]}}],"position":{"start":{"line":166,"column":4,"offset":6662},"end":{"line":166,"column":91,"offset":6749},"indent":[]}}],"position":{"start":{"line":166,"column":1,"offset":6659},"end":{"line":166,"column":91,"offset":6749},"indent":[]}}],"position":{"start":{"line":164,"column":1,"offset":6443},"end":{"line":166,"column":91,"offset":6749},"indent":[1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Try It Out","position":{"start":{"line":168,"column":4,"offset":6754},"end":{"line":168,"column":14,"offset":6764},"indent":[]}}],"position":{"start":{"line":168,"column":1,"offset":6751},"end":{"line":168,"column":14,"offset":6764},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Now run your tests and let's see the snapshots come to life! It should look similar to this:","position":{"start":{"line":170,"column":1,"offset":6766},"end":{"line":170,"column":93,"offset":6858},"indent":[]}}],"position":{"start":{"line":170,"column":1,"offset":6766},"end":{"line":170,"column":93,"offset":6858},"indent":[]}},{"type":"code","lang":"bash","meta":null,"value":"npm run test","position":{"start":{"line":172,"column":1,"offset":6860},"end":{"line":174,"column":4,"offset":6884},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Draft snapshot","position":{"start":{"line":176,"column":1,"offset":6886},"end":{"line":176,"column":15,"offset":6900},"indent":[]}}],"position":{"start":{"line":176,"column":1,"offset":6886},"end":{"line":176,"column":15,"offset":6900},"indent":[]}},{"type":"code","lang":"diff","meta":null,"value":"  // Snapshot that draft and expect `published` to be false\n  expect(result).toMatchInlineSnapshot(`\n+   Object {\n+     \"publish\": Object {\n+       \"id\": 1,\n+       \"title\": \"Nexus\",\n+       \"body\": \"...\",\n+       \"published\": false,\n+     },\n+   }\n  `)","position":{"start":{"line":178,"column":1,"offset":6902},"end":{"line":190,"column":4,"offset":7167},"indent":[1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Published draft snapshot","position":{"start":{"line":192,"column":1,"offset":7169},"end":{"line":192,"column":25,"offset":7193},"indent":[]}}],"position":{"start":{"line":192,"column":1,"offset":7169},"end":{"line":192,"column":25,"offset":7193},"indent":[]}},{"type":"code","lang":"diff","meta":null,"value":"  // Snapshot that draft and expect `published` to be false\n  expect(result).toMatchInlineSnapshot(`\n+   Object {\n+     \"publish\": Object {\n+       \"id\": 1,\n+       \"title\": \"Nexus\",\n+       \"body\": \"...\",\n+       \"published\": true,\n+     },\n+   }\n  `)","position":{"start":{"line":194,"column":1,"offset":7195},"end":{"line":206,"column":4,"offset":7459},"indent":[1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Awesome, beautiful workflow isn't it? If inline snapshots get too unweildly you can switch to regular snapshots and install ","position":{"start":{"line":208,"column":1,"offset":7461},"end":{"line":208,"column":125,"offset":7585},"indent":[]}},{"type":"link","title":null,"url":"https://marketplace.visualstudio.com/items?itemName=asvetliakov.snapshot-tools","children":[{"type":"text","value":"a VSCode plugin","position":{"start":{"line":208,"column":126,"offset":7586},"end":{"line":208,"column":141,"offset":7601},"indent":[]}}],"position":{"start":{"line":208,"column":125,"offset":7585},"end":{"line":208,"column":222,"offset":7682},"indent":[]}},{"type":"text","value":" that will display the snapshots upon hovering over the ","position":{"start":{"line":208,"column":222,"offset":7682},"end":{"line":208,"column":278,"offset":7738},"indent":[]}},{"type":"inlineCode","value":"toMatchSnapshot","position":{"start":{"line":208,"column":278,"offset":7738},"end":{"line":208,"column":295,"offset":7755},"indent":[]}},{"type":"text","value":" method name. While not quite as fluid as seeing inline snapshots throughout your test module, it may work better for you.","position":{"start":{"line":208,"column":295,"offset":7755},"end":{"line":208,"column":417,"offset":7877},"indent":[]}}],"position":{"start":{"line":208,"column":1,"offset":7461},"end":{"line":208,"column":417,"offset":7877},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Wrapping Up","position":{"start":{"line":210,"column":4,"offset":7882},"end":{"line":210,"column":15,"offset":7893},"indent":[]}}],"position":{"start":{"line":210,"column":1,"offset":7879},"end":{"line":210,"column":15,"offset":7893},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"You've just made a big step in the maintainability of your API. Here we showed how to test your ","position":{"start":{"line":212,"column":1,"offset":7895},"end":{"line":212,"column":97,"offset":7991},"indent":[]}},{"type":"inlineCode","value":"createDraft","position":{"start":{"line":212,"column":97,"offset":7991},"end":{"line":212,"column":110,"offset":8004},"indent":[]}},{"type":"text","value":" and ","position":{"start":{"line":212,"column":110,"offset":8004},"end":{"line":212,"column":115,"offset":8009},"indent":[]}},{"type":"inlineCode","value":"publish","position":{"start":{"line":212,"column":115,"offset":8009},"end":{"line":212,"column":124,"offset":8018},"indent":[]}},{"type":"text","value":" mutation, proving that a draft can be properly created and published. However you did ","position":{"start":{"line":212,"column":124,"offset":8018},"end":{"line":212,"column":211,"offset":8105},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"not","position":{"start":{"line":212,"column":212,"offset":8106},"end":{"line":212,"column":215,"offset":8109},"indent":[]}}],"position":{"start":{"line":212,"column":211,"offset":8105},"end":{"line":212,"column":216,"offset":8110},"indent":[]}},{"type":"text","value":" test if the draft was correctly persisted into your database. That piece will come soon! But first we need a real database in the first place. That's what the next chapter is all about!","position":{"start":{"line":212,"column":216,"offset":8110},"end":{"line":212,"column":402,"offset":8296},"indent":[]}}],"position":{"start":{"line":212,"column":1,"offset":7895},"end":{"line":212,"column":402,"offset":8296},"indent":[]}},{"type":"jsx","value":"<div class=\"NextIs NextChapter\"></div>","position":{"start":{"line":214,"column":1,"offset":8298},"end":{"line":214,"column":39,"offset":8336},"indent":[]}},{"type":"paragraph","children":[{"type":"link","title":null,"url":"/tutorial/chapter-5-persisting-data-via-prisma","children":[{"type":"text","value":"âž³","position":{"start":{"line":216,"column":2,"offset":8339},"end":{"line":216,"column":3,"offset":8340},"indent":[]}}],"position":{"start":{"line":216,"column":1,"offset":8338},"end":{"line":216,"column":52,"offset":8389},"indent":[]}}],"position":{"start":{"line":216,"column":1,"offset":8338},"end":{"line":216,"column":52,"offset":8389},"indent":[]}},{"type":"export","value":"export const _frontmatter = {\"title\":\"4. Testing Your API\"}","position":{"start":{"line":219,"column":1,"offset":8392},"end":{"line":219,"column":60,"offset":8451},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":219,"column":60,"offset":8451}}},"scopeImports":["import * as React from 'react'"],"scopeIdentifiers":["React"],"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"4. Testing Your API\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"\\\\n## Chapter 4 \", mdx(\"br\", null), \" Testing Your API\"), mdx(\"p\", null, \"So far you've been validating your work by manual interacting with the Playground. That might be reasonable at first (depending on your relationship to TDD) but it will not scale. At some point you are going to want automated testing. So in this chapter you're going to add some automated tests to your e-commerce project. You'll learn about:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Nexus' approach to testing\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Setting up a test environment\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"nexus/testing\"), \" module\")), mdx(\"section\", null, mdx(\"h2\", _extends({\n    parentName: \"section\"\n  }, {\n    \"id\": \"its-at-the-system-level\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }), mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#its-at-the-system-level\",\n    \"aria-label\": \"its at the system level permalink\",\n    \"className\": \"title-link before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"width\": \"17\",\n    \"height\": \"18\",\n    \"viewBox\": \"0 0 17 18\",\n    \"fill\": \"none\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\"\n  }), \"\\n      \", mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"d\": \"M1.5 6.33337H15.5\",\n    \"stroke\": \"#CBD5E0\",\n    \"strokeWidth\": \"2\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\"\n  })), \"\\n      \", mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"d\": \"M1.5 11.6666H15.5\",\n    \"stroke\": \"#CBD5E0\",\n    \"strokeWidth\": \"2\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\"\n  })), \"\\n      \", mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"d\": \"M6.75 1L5 17\",\n    \"stroke\": \"#CBD5E0\",\n    \"strokeWidth\": \"2\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\"\n  })), \"\\n      \", mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"d\": \"M12 1L10.25 17\",\n    \"stroke\": \"#CBD5E0\",\n    \"strokeWidth\": \"2\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\"\n  })), \"\\n      \")), \"It's At the System Level\"), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"There are multiple ways you can test a GraphQL API. One way is to extract resolvers into isolated functions and then unit test them. Of course these are rarely pure functions so those unit tests either become partial integration tests or mocks are introduced to try and retain the unit level of testing. Unit testing resolvers can work well, but here are some reasons why and where it might not;\"), mdx(\"ul\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The Nexus Prisma plugin (discussed later) can remove the need to even write resolvers in which case testing \", \"[those]\", \" resolvers doesn't make sense.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Thanks to the enhanced static type safety brought by Nexus, testing for correct handling of different input types and expected output types can be greatly reduced. For example you shouldn't need to test that your resolver checks for nulls before accessing nullable fields of an input object. And you don't need to test that your resolver is returning the right type.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Unit testing resolvers cannot provide a client perspective view of correctness since they focus on internals. If you want to test but have limited time/capacity to do so, you might choose to minimize/forgo the unit level in favor of system/integration tests that are closer to or at the level of a client perspective.\")), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"Testing non-trivial resolvers in isolation is likely to be a good investment in most cases but its up to you as a developer. What Nexus provides help with is not at this level, but higher up in the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://codingjourneyman.com/tag/uncle-bob/page/2/\"\n  }), \"testing pyramid\"), \", at the system level. System testing means tests that will run operations against your API just like a real client would. This chapter will focus on that. Let's dive-in!\")), mdx(\"section\", null, mdx(\"h2\", _extends({\n    parentName: \"section\"\n  }, {\n    \"id\": \"setting-up-your-test-environment\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }), mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#setting-up-your-test-environment\",\n    \"aria-label\": \"setting up your test environment permalink\",\n    \"className\": \"title-link before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"width\": \"17\",\n    \"height\": \"18\",\n    \"viewBox\": \"0 0 17 18\",\n    \"fill\": \"none\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\"\n  }), \"\\n      \", mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"d\": \"M1.5 6.33337H15.5\",\n    \"stroke\": \"#CBD5E0\",\n    \"strokeWidth\": \"2\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\"\n  })), \"\\n      \", mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"d\": \"M1.5 11.6666H15.5\",\n    \"stroke\": \"#CBD5E0\",\n    \"strokeWidth\": \"2\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\"\n  })), \"\\n      \", mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"d\": \"M6.75 1L5 17\",\n    \"stroke\": \"#CBD5E0\",\n    \"strokeWidth\": \"2\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\"\n  })), \"\\n      \", mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"d\": \"M12 1L10.25 17\",\n    \"stroke\": \"#CBD5E0\",\n    \"strokeWidth\": \"2\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\"\n  })), \"\\n      \")), \"Setting up Your Test Environment\"), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"During this tutorial, you'll use the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://jestjs.io/\"\n  }), \"Jest testing framework\"), \" to test your API. This is not mandatory but we do recommend it. Still, in general, outside this tutorial, if you prefer another testing framework, feel free to use it.\"), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"First, install \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"jest\"), \" and accompanying tools\"), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"npm add --save-dev jest @types/jest ts-jest\\n\")), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"Then, configure jest and npm scripts in your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"package.json\")), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-json\"\n  }), \"\\\"scripts\\\": {\\n  \\\"test\\\": \\\"jest\\\"\\n},\\n\\\"jest\\\": {\\n  \\\"preset\\\": \\\"ts-jest\\\",\\n  \\\"testEnvironment\\\": \\\"node\\\"\\n}\\n\")), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"Finally, create a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"tests\"), \" folder at the root of your project and a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Post.test.ts\"), \" file inside it\"), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"mkdir tests && touch tests/Post.test.ts\\n\")), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"You're set.\")), mdx(\"section\", null, mdx(\"h2\", _extends({\n    parentName: \"section\"\n  }, {\n    \"id\": \"testing-the-publish-mutation\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }), mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#testing-the-publish-mutation\",\n    \"aria-label\": \"testing the publish mutation permalink\",\n    \"className\": \"title-link before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"width\": \"17\",\n    \"height\": \"18\",\n    \"viewBox\": \"0 0 17 18\",\n    \"fill\": \"none\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\"\n  }), \"\\n      \", mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"d\": \"M1.5 6.33337H15.5\",\n    \"stroke\": \"#CBD5E0\",\n    \"strokeWidth\": \"2\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\"\n  })), \"\\n      \", mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"d\": \"M1.5 11.6666H15.5\",\n    \"stroke\": \"#CBD5E0\",\n    \"strokeWidth\": \"2\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\"\n  })), \"\\n      \", mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"d\": \"M6.75 1L5 17\",\n    \"stroke\": \"#CBD5E0\",\n    \"strokeWidth\": \"2\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\"\n  })), \"\\n      \", mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"d\": \"M12 1L10.25 17\",\n    \"stroke\": \"#CBD5E0\",\n    \"strokeWidth\": \"2\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\"\n  })), \"\\n      \")), \"Testing The Publish Mutation\"), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"Nexus comes with a special testing module that you can import from \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"nexus/testing\"), \".\"), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"Its primary export is the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"createTestContext\"), \" function which is designed for running system tests. When run, it will boot your app in the same process as the test suite and expose an interface for your tests to interact with it. Jest runs each test suite in its own process, so if you have have say eight test suites running in parallel that means you'll have eight app processes running too.\"), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"Before jumping into your first test we will show you a pattern that more tightly integrates \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"createTestContext\"), \" into jest. Nexus will probably ship something like as follows or better in the future, but for now you can just add this as test helper in your Nexus projects.\"), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"Create a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"tests/__helpers.ts\"), \" module with the following contents.\"), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"touch tests/__helpers.ts\\n\")), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-ts\"\n  }), \"// tests/__helpers.ts                                     // 1\\n\\nimport { createTestContext as originalCreateTestContext, TestContext } from 'nexus/testing'\\n\\nexport function createTestContext() {\\n  let ctx = {} as TestContext                             // 2\\n\\n  beforeAll(async () => {\\n    Object.assign(ctx, await originalCreateTestContext()) // 3\\n    await ctx.app.start()                                 // 4\\n  })\\n\\n  afterAll(async () => {\\n    await ctx.app.stop()                                  // 5\\n  })\\n\\n  return ctx\\n}\\n\")), mdx(\"ol\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"The module name prefix \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"__\"), \" matches that of jest's for snapshot folders \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"__snapshots__\")), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Create an object that will be returned immediately but mutated before tests run\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Before tests run create the test context. This does most of the work like getting your app instance.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Before tests run start the app\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"After tests complete, stop the app. This will for example close your app's HTTP server.\")), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"Alright, now you will test your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"publish\"), \" mutation. Because we want to start from a clean database, we'll just remove the pre-seeded data in the in-memory database that we've been using up until now.\"), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-diff\"\n  }), \"// api/db.ts\\nexport const db = {\\n- posts: [{ id: 1, title: 'Nexus', body: '...', published: false }],\\n+ posts: []\\n}\\n\")), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"Now use your new helper and scaffold your first test:\"), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-ts\"\n  }), \"// tests/Post.test.ts\\n\\nimport { createTestContext } from './__helpers'\\n\\nconst ctx = createTestContext()\\n\\nit('ensures that a draft can be created and published', async () => {\\n  // Create a new draft\\n  const draftResult = await ctx.app.query(`                 # 1\\n    mutation {\\n      createDraft(title: \\\"Nexus\\\", body: \\\"...\\\") {            # 2\\n        id\\n        title\\n        body\\n        published\\n      }\\n    }\\n  `)\\n\\n  // Snapshot that draft and expect `published` to be false\\n  expect(draftResult).toMatchInlineSnapshot(`                // 3\\n    Object {\\n      \\\"createDraft\\\": Object {\\n        \\\"body\\\": \\\"...\\\",\\n        \\\"id\\\": 1,\\n        \\\"published\\\": false,\\n        \\\"title\\\": \\\"Nexus\\\",\\n      },\\n    }\\n  `)\\n\\n  // Publish the previously created draft\\n  const publishResult = await ctx.app.query(`\\n    mutation publishDraft($draftId: Int!) {\\n      publish(draftId: $draftId) {\\n        id\\n        title\\n        body\\n        published\\n      }\\n    }\\n  `,\\n    { draftId: draftResult.createDraft.id }\\n  )\\n\\n  // Snapshot the published draft and expect `published` to be true\\n  expect(publishResult).toMatchInlineSnapshot(`\\n    Object {\\n      \\\"publish\\\": Object {\\n        \\\"body\\\": \\\"...\\\",\\n        \\\"id\\\": 1,\\n        \\\"published\\\": true,\\n        \\\"title\\\": \\\"Nexus\\\",\\n      },\\n    }\\n  `)\\n})\\n\")), mdx(\"ol\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"The test context exposes a GraphQL client at \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"ctx.app.query\"), \" that will help us run operations against our API. Here We're using it to send a publish mutation.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"This is the mutation from the end of last chapter.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"The result will be snapshoted inline allowing us to see the input and output colocated!\"))), mdx(\"section\", null, mdx(\"h2\", _extends({\n    parentName: \"section\"\n  }, {\n    \"id\": \"try-it-out\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }), mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#try-it-out\",\n    \"aria-label\": \"try it out permalink\",\n    \"className\": \"title-link before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"width\": \"17\",\n    \"height\": \"18\",\n    \"viewBox\": \"0 0 17 18\",\n    \"fill\": \"none\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\"\n  }), \"\\n      \", mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"d\": \"M1.5 6.33337H15.5\",\n    \"stroke\": \"#CBD5E0\",\n    \"strokeWidth\": \"2\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\"\n  })), \"\\n      \", mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"d\": \"M1.5 11.6666H15.5\",\n    \"stroke\": \"#CBD5E0\",\n    \"strokeWidth\": \"2\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\"\n  })), \"\\n      \", mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"d\": \"M6.75 1L5 17\",\n    \"stroke\": \"#CBD5E0\",\n    \"strokeWidth\": \"2\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\"\n  })), \"\\n      \", mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"d\": \"M12 1L10.25 17\",\n    \"stroke\": \"#CBD5E0\",\n    \"strokeWidth\": \"2\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\"\n  })), \"\\n      \")), \"Try It Out\"), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"Now run your tests and let's see the snapshots come to life! It should look similar to this:\"), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"npm run test\\n\")), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"Draft snapshot\"), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-diff\"\n  }), \"  // Snapshot that draft and expect `published` to be false\\n  expect(result).toMatchInlineSnapshot(`\\n+   Object {\\n+     \\\"publish\\\": Object {\\n+       \\\"id\\\": 1,\\n+       \\\"title\\\": \\\"Nexus\\\",\\n+       \\\"body\\\": \\\"...\\\",\\n+       \\\"published\\\": false,\\n+     },\\n+   }\\n  `)\\n\")), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"Published draft snapshot\"), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-diff\"\n  }), \"  // Snapshot that draft and expect `published` to be false\\n  expect(result).toMatchInlineSnapshot(`\\n+   Object {\\n+     \\\"publish\\\": Object {\\n+       \\\"id\\\": 1,\\n+       \\\"title\\\": \\\"Nexus\\\",\\n+       \\\"body\\\": \\\"...\\\",\\n+       \\\"published\\\": true,\\n+     },\\n+   }\\n  `)\\n\")), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"Awesome, beautiful workflow isn't it? If inline snapshots get too unweildly you can switch to regular snapshots and install \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://marketplace.visualstudio.com/items?itemName=asvetliakov.snapshot-tools\"\n  }), \"a VSCode plugin\"), \" that will display the snapshots upon hovering over the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"toMatchSnapshot\"), \" method name. While not quite as fluid as seeing inline snapshots throughout your test module, it may work better for you.\")), mdx(\"section\", null, mdx(\"h2\", _extends({\n    parentName: \"section\"\n  }, {\n    \"id\": \"wrapping-up\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }), mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#wrapping-up\",\n    \"aria-label\": \"wrapping up permalink\",\n    \"className\": \"title-link before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"width\": \"17\",\n    \"height\": \"18\",\n    \"viewBox\": \"0 0 17 18\",\n    \"fill\": \"none\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\"\n  }), \"\\n      \", mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"d\": \"M1.5 6.33337H15.5\",\n    \"stroke\": \"#CBD5E0\",\n    \"strokeWidth\": \"2\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\"\n  })), \"\\n      \", mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"d\": \"M1.5 11.6666H15.5\",\n    \"stroke\": \"#CBD5E0\",\n    \"strokeWidth\": \"2\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\"\n  })), \"\\n      \", mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"d\": \"M6.75 1L5 17\",\n    \"stroke\": \"#CBD5E0\",\n    \"strokeWidth\": \"2\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\"\n  })), \"\\n      \", mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"d\": \"M12 1L10.25 17\",\n    \"stroke\": \"#CBD5E0\",\n    \"strokeWidth\": \"2\",\n    \"strokeLineCap\": \"round\",\n    \"strokeLineJoin\": \"round\"\n  })), \"\\n      \")), \"Wrapping Up\"), mdx(\"p\", {\n    parentName: \"section\"\n  }, \"You've just made a big step in the maintainability of your API. Here we showed how to test your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"createDraft\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"publish\"), \" mutation, proving that a draft can be properly created and published. However you did \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"not\"), \" test if the draft was correctly persisted into your database. That piece will come soon! But first we need a real database in the first place. That's what the next chapter is all about!\"), mdx(\"div\", {\n    className: \"NextIs NextChapter\"\n  }), mdx(\"p\", {\n    parentName: \"section\"\n  }, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"/tutorial/chapter-5-persisting-data-via-prisma\"\n  }), \"\\u27B3\"))));\n}\n;\nMDXContent.isMDXComponent = true;","rawMDXOutput":"/* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nexport const _frontmatter = {\n  \"title\": \"4. Testing Your API\"\n};\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n  return <div {...props}/>\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`\\\\n## Chapter 4 `}<br />{` Testing Your API`}</p>\n    <p>{`So far you've been validating your work by manual interacting with the Playground. That might be reasonable at first (depending on your relationship to TDD) but it will not scale. At some point you are going to want automated testing. So in this chapter you're going to add some automated tests to your e-commerce project. You'll learn about:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Nexus' approach to testing`}</li>\n      <li parentName=\"ul\">{`Setting up a test environment`}</li>\n      <li parentName=\"ul\">{`The `}<inlineCode parentName=\"li\">{`nexus/testing`}</inlineCode>{` module`}</li>\n    </ul>\n    <section><h2 parentName=\"section\" {...{\n        \"id\": \"its-at-the-system-level\",\n        \"style\": {\n          \"position\": \"relative\"\n        }\n      }}><a parentName=\"h2\" {...{\n          \"href\": \"#its-at-the-system-level\",\n          \"aria-label\": \"its at the system level permalink\",\n          \"className\": \"title-link before\"\n        }}><svg parentName=\"a\" {...{\n            \"width\": \"17\",\n            \"height\": \"18\",\n            \"viewBox\": \"0 0 17 18\",\n            \"fill\": \"none\",\n            \"xmlns\": \"http://www.w3.org/2000/svg\"\n          }}>{`\n      `}<path parentName=\"svg\" {...{\n              \"d\": \"M1.5 6.33337H15.5\",\n              \"stroke\": \"#CBD5E0\",\n              \"strokeWidth\": \"2\",\n              \"strokeLineCap\": \"round\",\n              \"strokeLineJoin\": \"round\"\n            }}></path>{`\n      `}<path parentName=\"svg\" {...{\n              \"d\": \"M1.5 11.6666H15.5\",\n              \"stroke\": \"#CBD5E0\",\n              \"strokeWidth\": \"2\",\n              \"strokeLineCap\": \"round\",\n              \"strokeLineJoin\": \"round\"\n            }}></path>{`\n      `}<path parentName=\"svg\" {...{\n              \"d\": \"M6.75 1L5 17\",\n              \"stroke\": \"#CBD5E0\",\n              \"strokeWidth\": \"2\",\n              \"strokeLineCap\": \"round\",\n              \"strokeLineJoin\": \"round\"\n            }}></path>{`\n      `}<path parentName=\"svg\" {...{\n              \"d\": \"M12 1L10.25 17\",\n              \"stroke\": \"#CBD5E0\",\n              \"strokeWidth\": \"2\",\n              \"strokeLineCap\": \"round\",\n              \"strokeLineJoin\": \"round\"\n            }}></path>{`\n      `}</svg></a>{`It's At the System Level`}</h2><p parentName=\"section\">{`There are multiple ways you can test a GraphQL API. One way is to extract resolvers into isolated functions and then unit test them. Of course these are rarely pure functions so those unit tests either become partial integration tests or mocks are introduced to try and retain the unit level of testing. Unit testing resolvers can work well, but here are some reasons why and where it might not;`}</p><ul parentName=\"section\">\n        <li parentName=\"ul\">{`The Nexus Prisma plugin (discussed later) can remove the need to even write resolvers in which case testing `}{`[those]`}{` resolvers doesn't make sense.`}</li>\n        <li parentName=\"ul\">{`Thanks to the enhanced static type safety brought by Nexus, testing for correct handling of different input types and expected output types can be greatly reduced. For example you shouldn't need to test that your resolver checks for nulls before accessing nullable fields of an input object. And you don't need to test that your resolver is returning the right type.`}</li>\n        <li parentName=\"ul\">{`Unit testing resolvers cannot provide a client perspective view of correctness since they focus on internals. If you want to test but have limited time/capacity to do so, you might choose to minimize/forgo the unit level in favor of system/integration tests that are closer to or at the level of a client perspective.`}</li>\n      </ul><p parentName=\"section\">{`Testing non-trivial resolvers in isolation is likely to be a good investment in most cases but its up to you as a developer. What Nexus provides help with is not at this level, but higher up in the `}<a parentName=\"p\" {...{\n          \"href\": \"https://codingjourneyman.com/tag/uncle-bob/page/2/\"\n        }}>{`testing pyramid`}</a>{`, at the system level. System testing means tests that will run operations against your API just like a real client would. This chapter will focus on that. Let's dive-in!`}</p></section>\n    <section><h2 parentName=\"section\" {...{\n        \"id\": \"setting-up-your-test-environment\",\n        \"style\": {\n          \"position\": \"relative\"\n        }\n      }}><a parentName=\"h2\" {...{\n          \"href\": \"#setting-up-your-test-environment\",\n          \"aria-label\": \"setting up your test environment permalink\",\n          \"className\": \"title-link before\"\n        }}><svg parentName=\"a\" {...{\n            \"width\": \"17\",\n            \"height\": \"18\",\n            \"viewBox\": \"0 0 17 18\",\n            \"fill\": \"none\",\n            \"xmlns\": \"http://www.w3.org/2000/svg\"\n          }}>{`\n      `}<path parentName=\"svg\" {...{\n              \"d\": \"M1.5 6.33337H15.5\",\n              \"stroke\": \"#CBD5E0\",\n              \"strokeWidth\": \"2\",\n              \"strokeLineCap\": \"round\",\n              \"strokeLineJoin\": \"round\"\n            }}></path>{`\n      `}<path parentName=\"svg\" {...{\n              \"d\": \"M1.5 11.6666H15.5\",\n              \"stroke\": \"#CBD5E0\",\n              \"strokeWidth\": \"2\",\n              \"strokeLineCap\": \"round\",\n              \"strokeLineJoin\": \"round\"\n            }}></path>{`\n      `}<path parentName=\"svg\" {...{\n              \"d\": \"M6.75 1L5 17\",\n              \"stroke\": \"#CBD5E0\",\n              \"strokeWidth\": \"2\",\n              \"strokeLineCap\": \"round\",\n              \"strokeLineJoin\": \"round\"\n            }}></path>{`\n      `}<path parentName=\"svg\" {...{\n              \"d\": \"M12 1L10.25 17\",\n              \"stroke\": \"#CBD5E0\",\n              \"strokeWidth\": \"2\",\n              \"strokeLineCap\": \"round\",\n              \"strokeLineJoin\": \"round\"\n            }}></path>{`\n      `}</svg></a>{`Setting up Your Test Environment`}</h2><p parentName=\"section\">{`During this tutorial, you'll use the `}<a parentName=\"p\" {...{\n          \"href\": \"https://jestjs.io/\"\n        }}>{`Jest testing framework`}</a>{` to test your API. This is not mandatory but we do recommend it. Still, in general, outside this tutorial, if you prefer another testing framework, feel free to use it.`}</p><p parentName=\"section\">{`First, install `}<inlineCode parentName=\"p\">{`jest`}</inlineCode>{` and accompanying tools`}</p><pre parentName=\"section\"><code parentName=\"pre\" {...{\n          \"className\": \"language-bash\"\n        }}>{`npm add --save-dev jest @types/jest ts-jest\n`}</code></pre><p parentName=\"section\">{`Then, configure jest and npm scripts in your `}<inlineCode parentName=\"p\">{`package.json`}</inlineCode></p><pre parentName=\"section\"><code parentName=\"pre\" {...{\n          \"className\": \"language-json\"\n        }}>{`\"scripts\": {\n  \"test\": \"jest\"\n},\n\"jest\": {\n  \"preset\": \"ts-jest\",\n  \"testEnvironment\": \"node\"\n}\n`}</code></pre><p parentName=\"section\">{`Finally, create a `}<inlineCode parentName=\"p\">{`tests`}</inlineCode>{` folder at the root of your project and a `}<inlineCode parentName=\"p\">{`Post.test.ts`}</inlineCode>{` file inside it`}</p><pre parentName=\"section\"><code parentName=\"pre\" {...{\n          \"className\": \"language-bash\"\n        }}>{`mkdir tests && touch tests/Post.test.ts\n`}</code></pre><p parentName=\"section\">{`You're set.`}</p></section>\n    <section><h2 parentName=\"section\" {...{\n        \"id\": \"testing-the-publish-mutation\",\n        \"style\": {\n          \"position\": \"relative\"\n        }\n      }}><a parentName=\"h2\" {...{\n          \"href\": \"#testing-the-publish-mutation\",\n          \"aria-label\": \"testing the publish mutation permalink\",\n          \"className\": \"title-link before\"\n        }}><svg parentName=\"a\" {...{\n            \"width\": \"17\",\n            \"height\": \"18\",\n            \"viewBox\": \"0 0 17 18\",\n            \"fill\": \"none\",\n            \"xmlns\": \"http://www.w3.org/2000/svg\"\n          }}>{`\n      `}<path parentName=\"svg\" {...{\n              \"d\": \"M1.5 6.33337H15.5\",\n              \"stroke\": \"#CBD5E0\",\n              \"strokeWidth\": \"2\",\n              \"strokeLineCap\": \"round\",\n              \"strokeLineJoin\": \"round\"\n            }}></path>{`\n      `}<path parentName=\"svg\" {...{\n              \"d\": \"M1.5 11.6666H15.5\",\n              \"stroke\": \"#CBD5E0\",\n              \"strokeWidth\": \"2\",\n              \"strokeLineCap\": \"round\",\n              \"strokeLineJoin\": \"round\"\n            }}></path>{`\n      `}<path parentName=\"svg\" {...{\n              \"d\": \"M6.75 1L5 17\",\n              \"stroke\": \"#CBD5E0\",\n              \"strokeWidth\": \"2\",\n              \"strokeLineCap\": \"round\",\n              \"strokeLineJoin\": \"round\"\n            }}></path>{`\n      `}<path parentName=\"svg\" {...{\n              \"d\": \"M12 1L10.25 17\",\n              \"stroke\": \"#CBD5E0\",\n              \"strokeWidth\": \"2\",\n              \"strokeLineCap\": \"round\",\n              \"strokeLineJoin\": \"round\"\n            }}></path>{`\n      `}</svg></a>{`Testing The Publish Mutation`}</h2><p parentName=\"section\">{`Nexus comes with a special testing module that you can import from `}<inlineCode parentName=\"p\">{`nexus/testing`}</inlineCode>{`.`}</p><p parentName=\"section\">{`Its primary export is the `}<inlineCode parentName=\"p\">{`createTestContext`}</inlineCode>{` function which is designed for running system tests. When run, it will boot your app in the same process as the test suite and expose an interface for your tests to interact with it. Jest runs each test suite in its own process, so if you have have say eight test suites running in parallel that means you'll have eight app processes running too.`}</p><p parentName=\"section\">{`Before jumping into your first test we will show you a pattern that more tightly integrates `}<inlineCode parentName=\"p\">{`createTestContext`}</inlineCode>{` into jest. Nexus will probably ship something like as follows or better in the future, but for now you can just add this as test helper in your Nexus projects.`}</p><p parentName=\"section\">{`Create a `}<inlineCode parentName=\"p\">{`tests/__helpers.ts`}</inlineCode>{` module with the following contents.`}</p><pre parentName=\"section\"><code parentName=\"pre\" {...{\n          \"className\": \"language-bash\"\n        }}>{`touch tests/__helpers.ts\n`}</code></pre>{\n        /* prettier-ignore */\n      }<pre parentName=\"section\"><code parentName=\"pre\" {...{\n          \"className\": \"language-ts\"\n        }}>{`// tests/__helpers.ts                                     // 1\n\nimport { createTestContext as originalCreateTestContext, TestContext } from 'nexus/testing'\n\nexport function createTestContext() {\n  let ctx = {} as TestContext                             // 2\n\n  beforeAll(async () => {\n    Object.assign(ctx, await originalCreateTestContext()) // 3\n    await ctx.app.start()                                 // 4\n  })\n\n  afterAll(async () => {\n    await ctx.app.stop()                                  // 5\n  })\n\n  return ctx\n}\n`}</code></pre><ol parentName=\"section\">\n        <li parentName=\"ol\">{`The module name prefix `}<inlineCode parentName=\"li\">{`__`}</inlineCode>{` matches that of jest's for snapshot folders `}<inlineCode parentName=\"li\">{`__snapshots__`}</inlineCode></li>\n        <li parentName=\"ol\">{`Create an object that will be returned immediately but mutated before tests run`}</li>\n        <li parentName=\"ol\">{`Before tests run create the test context. This does most of the work like getting your app instance.`}</li>\n        <li parentName=\"ol\">{`Before tests run start the app`}</li>\n        <li parentName=\"ol\">{`After tests complete, stop the app. This will for example close your app's HTTP server.`}</li>\n      </ol><p parentName=\"section\">{`Alright, now you will test your `}<inlineCode parentName=\"p\">{`publish`}</inlineCode>{` mutation. Because we want to start from a clean database, we'll just remove the pre-seeded data in the in-memory database that we've been using up until now.`}</p><pre parentName=\"section\"><code parentName=\"pre\" {...{\n          \"className\": \"language-diff\"\n        }}>{`// api/db.ts\nexport const db = {\n- posts: [{ id: 1, title: 'Nexus', body: '...', published: false }],\n+ posts: []\n}\n`}</code></pre><p parentName=\"section\">{`Now use your new helper and scaffold your first test:`}</p>{\n        /* prettier-ignore */\n      }<pre parentName=\"section\"><code parentName=\"pre\" {...{\n          \"className\": \"language-ts\"\n        }}>{`// tests/Post.test.ts\n\nimport { createTestContext } from './__helpers'\n\nconst ctx = createTestContext()\n\nit('ensures that a draft can be created and published', async () => {\n  // Create a new draft\n  const draftResult = await ctx.app.query(\\`                 # 1\n    mutation {\n      createDraft(title: \"Nexus\", body: \"...\") {            # 2\n        id\n        title\n        body\n        published\n      }\n    }\n  \\`)\n\n  // Snapshot that draft and expect \\`published\\` to be false\n  expect(draftResult).toMatchInlineSnapshot(\\`                // 3\n    Object {\n      \"createDraft\": Object {\n        \"body\": \"...\",\n        \"id\": 1,\n        \"published\": false,\n        \"title\": \"Nexus\",\n      },\n    }\n  \\`)\n\n  // Publish the previously created draft\n  const publishResult = await ctx.app.query(\\`\n    mutation publishDraft($draftId: Int!) {\n      publish(draftId: $draftId) {\n        id\n        title\n        body\n        published\n      }\n    }\n  \\`,\n    { draftId: draftResult.createDraft.id }\n  )\n\n  // Snapshot the published draft and expect \\`published\\` to be true\n  expect(publishResult).toMatchInlineSnapshot(\\`\n    Object {\n      \"publish\": Object {\n        \"body\": \"...\",\n        \"id\": 1,\n        \"published\": true,\n        \"title\": \"Nexus\",\n      },\n    }\n  \\`)\n})\n`}</code></pre><ol parentName=\"section\">\n        <li parentName=\"ol\">{`The test context exposes a GraphQL client at `}<inlineCode parentName=\"li\">{`ctx.app.query`}</inlineCode>{` that will help us run operations against our API. Here We're using it to send a publish mutation.`}</li>\n        <li parentName=\"ol\">{`This is the mutation from the end of last chapter.`}</li>\n        <li parentName=\"ol\">{`The result will be snapshoted inline allowing us to see the input and output colocated!`}</li>\n      </ol></section>\n    <section><h2 parentName=\"section\" {...{\n        \"id\": \"try-it-out\",\n        \"style\": {\n          \"position\": \"relative\"\n        }\n      }}><a parentName=\"h2\" {...{\n          \"href\": \"#try-it-out\",\n          \"aria-label\": \"try it out permalink\",\n          \"className\": \"title-link before\"\n        }}><svg parentName=\"a\" {...{\n            \"width\": \"17\",\n            \"height\": \"18\",\n            \"viewBox\": \"0 0 17 18\",\n            \"fill\": \"none\",\n            \"xmlns\": \"http://www.w3.org/2000/svg\"\n          }}>{`\n      `}<path parentName=\"svg\" {...{\n              \"d\": \"M1.5 6.33337H15.5\",\n              \"stroke\": \"#CBD5E0\",\n              \"strokeWidth\": \"2\",\n              \"strokeLineCap\": \"round\",\n              \"strokeLineJoin\": \"round\"\n            }}></path>{`\n      `}<path parentName=\"svg\" {...{\n              \"d\": \"M1.5 11.6666H15.5\",\n              \"stroke\": \"#CBD5E0\",\n              \"strokeWidth\": \"2\",\n              \"strokeLineCap\": \"round\",\n              \"strokeLineJoin\": \"round\"\n            }}></path>{`\n      `}<path parentName=\"svg\" {...{\n              \"d\": \"M6.75 1L5 17\",\n              \"stroke\": \"#CBD5E0\",\n              \"strokeWidth\": \"2\",\n              \"strokeLineCap\": \"round\",\n              \"strokeLineJoin\": \"round\"\n            }}></path>{`\n      `}<path parentName=\"svg\" {...{\n              \"d\": \"M12 1L10.25 17\",\n              \"stroke\": \"#CBD5E0\",\n              \"strokeWidth\": \"2\",\n              \"strokeLineCap\": \"round\",\n              \"strokeLineJoin\": \"round\"\n            }}></path>{`\n      `}</svg></a>{`Try It Out`}</h2><p parentName=\"section\">{`Now run your tests and let's see the snapshots come to life! It should look similar to this:`}</p><pre parentName=\"section\"><code parentName=\"pre\" {...{\n          \"className\": \"language-bash\"\n        }}>{`npm run test\n`}</code></pre><p parentName=\"section\">{`Draft snapshot`}</p><pre parentName=\"section\"><code parentName=\"pre\" {...{\n          \"className\": \"language-diff\"\n        }}>{`  // Snapshot that draft and expect \\`published\\` to be false\n  expect(result).toMatchInlineSnapshot(\\`\n+   Object {\n+     \"publish\": Object {\n+       \"id\": 1,\n+       \"title\": \"Nexus\",\n+       \"body\": \"...\",\n+       \"published\": false,\n+     },\n+   }\n  \\`)\n`}</code></pre><p parentName=\"section\">{`Published draft snapshot`}</p><pre parentName=\"section\"><code parentName=\"pre\" {...{\n          \"className\": \"language-diff\"\n        }}>{`  // Snapshot that draft and expect \\`published\\` to be false\n  expect(result).toMatchInlineSnapshot(\\`\n+   Object {\n+     \"publish\": Object {\n+       \"id\": 1,\n+       \"title\": \"Nexus\",\n+       \"body\": \"...\",\n+       \"published\": true,\n+     },\n+   }\n  \\`)\n`}</code></pre><p parentName=\"section\">{`Awesome, beautiful workflow isn't it? If inline snapshots get too unweildly you can switch to regular snapshots and install `}<a parentName=\"p\" {...{\n          \"href\": \"https://marketplace.visualstudio.com/items?itemName=asvetliakov.snapshot-tools\"\n        }}>{`a VSCode plugin`}</a>{` that will display the snapshots upon hovering over the `}<inlineCode parentName=\"p\">{`toMatchSnapshot`}</inlineCode>{` method name. While not quite as fluid as seeing inline snapshots throughout your test module, it may work better for you.`}</p></section>\n    <section><h2 parentName=\"section\" {...{\n        \"id\": \"wrapping-up\",\n        \"style\": {\n          \"position\": \"relative\"\n        }\n      }}><a parentName=\"h2\" {...{\n          \"href\": \"#wrapping-up\",\n          \"aria-label\": \"wrapping up permalink\",\n          \"className\": \"title-link before\"\n        }}><svg parentName=\"a\" {...{\n            \"width\": \"17\",\n            \"height\": \"18\",\n            \"viewBox\": \"0 0 17 18\",\n            \"fill\": \"none\",\n            \"xmlns\": \"http://www.w3.org/2000/svg\"\n          }}>{`\n      `}<path parentName=\"svg\" {...{\n              \"d\": \"M1.5 6.33337H15.5\",\n              \"stroke\": \"#CBD5E0\",\n              \"strokeWidth\": \"2\",\n              \"strokeLineCap\": \"round\",\n              \"strokeLineJoin\": \"round\"\n            }}></path>{`\n      `}<path parentName=\"svg\" {...{\n              \"d\": \"M1.5 11.6666H15.5\",\n              \"stroke\": \"#CBD5E0\",\n              \"strokeWidth\": \"2\",\n              \"strokeLineCap\": \"round\",\n              \"strokeLineJoin\": \"round\"\n            }}></path>{`\n      `}<path parentName=\"svg\" {...{\n              \"d\": \"M6.75 1L5 17\",\n              \"stroke\": \"#CBD5E0\",\n              \"strokeWidth\": \"2\",\n              \"strokeLineCap\": \"round\",\n              \"strokeLineJoin\": \"round\"\n            }}></path>{`\n      `}<path parentName=\"svg\" {...{\n              \"d\": \"M12 1L10.25 17\",\n              \"stroke\": \"#CBD5E0\",\n              \"strokeWidth\": \"2\",\n              \"strokeLineCap\": \"round\",\n              \"strokeLineJoin\": \"round\"\n            }}></path>{`\n      `}</svg></a>{`Wrapping Up`}</h2><p parentName=\"section\">{`You've just made a big step in the maintainability of your API. Here we showed how to test your `}<inlineCode parentName=\"p\">{`createDraft`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`publish`}</inlineCode>{` mutation, proving that a draft can be properly created and published. However you did `}<em parentName=\"p\">{`not`}</em>{` test if the draft was correctly persisted into your database. That piece will come soon! But first we need a real database in the first place. That's what the next chapter is all about!`}</p><div class=\"NextIs NextChapter\"></div><p parentName=\"section\"><a parentName=\"p\" {...{\n          \"href\": \"/tutorial/chapter-5-persisting-data-via-prisma\"\n        }}>{`âž³`}</a></p></section>\n\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"}}